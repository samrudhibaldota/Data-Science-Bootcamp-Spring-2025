
-- Create Tables
CREATE TABLE SALES (
    Date TEXT,
    Order_id INTEGER,
    Item_id INTEGER,
    Customer_id INTEGER,
    Quantity INTEGER,
    Revenue REAL
);

CREATE TABLE ITEMS (
    Item_id INTEGER,
    Item_name TEXT,
    Price REAL,
    Department TEXT
);

CREATE TABLE CUSTOMERS (
    Customer_id INTEGER,
    First_name TEXT,
    Last_name TEXT,
    Address TEXT
);

-- Sample Data
INSERT INTO SALES VALUES 
('2023-03-18', 1, 101, 1, 2, 200),
('2023-03-18', 2, 102, 2, 1, 120),
('2023-01-10', 3, 103, 3, 1, 75),
('2023-01-15', 4, 104, 4, 3, 225),
('2022-11-20', 5, 105, 5, 2, 150),
('2022-08-10', 6, 106, 6, 1, 120),
('2022-05-01', 7, 107, 7, 1, 90);

INSERT INTO CUSTOMERS VALUES
(1, 'John', 'Doe', '123 Main St'),
(2, 'Alice', 'Smith', '456 Oak Ave'),
(3, 'Bob', 'Brown', '789 Pine Rd'),
(4, 'Jane', 'Doe', '147 Elm St'),
(5, 'Charlie', 'Wilson', '963 Cedar Ln'),
(6, 'Emma', 'Jones', '321 Birch St'),
(7, 'John', 'Doe', '555 Maple St');

INSERT INTO ITEMS VALUES
(101, 'Widget', 100, 'Gadgets'),
(102, 'Gizmo', 120, 'Gadgets'),
(103, 'Thingy', 75, 'Accessories'),
(104, 'Doohickey', 75, 'Accessories'),
(105, 'Device', 75, 'Electronics'),
(106, 'Tool', 120, 'Tools'),
(107, 'Accessory', 90, 'Accessories');

-- Q1
-- Total number of orders completed on 18th March 2023
SELECT COUNT(DISTINCT Order_id) AS total_orders
FROM SALES
WHERE Date = '2023-03-18';

-- Q2
-- Orders completed on 18th March 2023 by customer John Doe
SELECT COUNT(DISTINCT s.Order_id) AS john_doe_orders
FROM SALES s
JOIN CUSTOMERS c ON s.Customer_id = c.Customer_id
WHERE s.Date = '2023-03-18' 
  AND c.First_name = 'John' 
  AND c.Last_name = 'Doe';

-- Q3
-- Customers in Jan 2023 and average spend per customer
SELECT COUNT(DISTINCT Customer_id) AS total_customers,
       ROUND(SUM(Revenue) / COUNT(DISTINCT Customer_id), 2) AS avg_spend_per_customer
FROM SALES
WHERE strftime('%Y-%m', Date) = '2023-01';

-- Q4
-- Departments generating less than $600 in 2022
SELECT i.Department, SUM(s.Revenue) AS total_revenue
FROM SALES s
JOIN ITEMS i ON s.Item_id = i.Item_id
WHERE strftime('%Y', s.Date) = '2022'
GROUP BY i.Department
HAVING total_revenue < 600;

-- Q5
-- Most and least revenue generated by an order
SELECT 
  MAX(Revenue) AS max_revenue, 
  MIN(Revenue) AS min_revenue
FROM SALES;

-- Q6
-- Orders with the most revenue
SELECT *
FROM SALES
WHERE Revenue = (SELECT MAX(Revenue) FROM SALES);
